---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
Before we dive, we quickly load any supporting libraries.
```{r library_load}
library(ggplot2)
library(dplyr)
```

## Loading and preprocessing the data
The data is included with this HTML report and the markdown files used to 
generate the HTML report.

The data starts its life as a zip file, "activity.zip", in the local working
directory. We need to unzip the file, import the contents, and then clean up 
the unzipped messy-ness.

**Note:** This code assumes that your working directory has been set correctly.

```{r unzip_import}
# unzip the file
unzip("./activity.zip")
# get the data
act <- read.csv("./activity.csv")
# clean up the csv
unlink("./activity.csv")
```

We then take a quick pause to add another date variable (in case we want to
treat our dates as dates and not as factors.)
```{r datetime}
act$date_as_date <- strptime(as.character(act$date), "%Y-%m-%d")
```

## What is mean total number of steps taken per day?
Our data has many step measurements for each day.

```{r mean_steps}
# first we get the total steps for each unique day
steps_per_day <- aggregate(steps ~ date, act, sum, na.rm = TRUE)

# then we take the mean of that aggregation
mean(steps_per_day$steps)
```

We may also want to consider the median value...
```{r median_steps}
median(steps_per_day$steps)
```

Or just visualize the distribution of steps per day.
```{r hist_steps}
ggplot(act, aes(x = date_as_date, y = steps)) + 
    geom_histogram(stat = "identity")
```

## What is the average daily activity pattern?
First we find the average steps per interval (across days).
```{r mean_interval}
mean_per_interval <- aggregate(steps ~ interval, act, mean, na.rm = T)
```

Then we make a histogram showing off the interval data.
```{r hist_interval}
ggplot(mean_per_interval, aes(x = interval, y = steps)) + 
    geom_line()
```

Finally we note which of the intervals had the largest average number of steps.
```{r largest_interval}
# sort largest to smallest, return just the first (largest) result
arrange(mean_per_interval, desc(steps))[1,]
```

## Imputing missing values
Determine how many NAs are in the data set.
```{r get_nas}
summary(act)
```

Replace any NAs with the mean of its interval.
```{r imputed_data}
# first we define a function to replace NAs with their interval means
impute_means <- function(act, mean_per_interval) {
    # for each interval in our mean_per_interval collection...
    for(index in 1:nrow(mean_per_interval)) {
        # find which rows in our primary data match the interval AND are NA
        na_indices <- which(act$interval == mean_per_interval$interval[[index]] &
                                is.na(act$steps)
        )
        # get the mean of the current interval
        subset_mean <- mean_per_interval$steps[[index]]
        
        # replace the NAs in the primary data for that interval with
        # the interval mean
        act$steps <- replace(act$steps, na_indices, subset_mean)
    }
    
    # return the new dataset
    return(act)
}

# then we call the function to get the data set with imputed values
act_imputed <- impute_means(act, mean_per_interval)
```

Show the updated mean and median per day, along with the updated histogram.
```{r new_steps}
# first we aggregate the steps by day again...
imputed_steps_per_day <- aggregate(steps ~ date, act_imputed, sum)

# now we report the mean...
mean(imputed_steps_per_day$steps)

# and the median...
median(imputed_steps_per_day$steps)

# and the histogram...
ggplot(act_imputed, aes(x = date_as_date, y = steps)) + 
    geom_histogram(stat = "identity")
```

The histogram is nicely more filled in than before imputing but the overall
mean and average changed little.

## Are there differences in activity patterns between weekdays and weekends?
Add a new factor specifying weekdays and weekends.
```{r daytype}
# if the weekday is equivalent to Saturday or Sunday...
act_imputed$day_type <- ifelse(weekdays(act_imputed$date_as_date) == "Saturday" | 
                                   weekdays(act_imputed$date_as_date) == "Sunday", 
                               # call it a weekend
                               "Weekend", 
                               # otherwise call it a weekday
                               "Weekday")
```

Then we need to get the average steps by interval + day type.
```{r steps_interval_daytype}
mean_per_interval_day <- aggregate(steps ~ interval + day_type, 
                                   act_imputed, 
                                   mean)
```


Contrast weekdays and weekends via plot.
```{r daytype_plot}
ggplot(mean_per_interval_day, aes(x = interval, y = steps)) + 
    geom_line() +
    facet_wrap(~day_type)
```